<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Badminton Skill Challenge</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --ink: #263159;
      --primary: #FF8F52;
      --headline: #495579;
      --paper: #FFFDF7;
      --success: #16a34a;
      --danger: #ef4444;
      --accent: #8b5cf6;
    }
    body { background: var(--paper); color: var(--ink); }
    .card { background:#fff; border-radius: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,.08); }

    .stamp-wrap { position: relative; }
    .stamp-svg {
      position:absolute; top:-10px; left:50%; transform:translateX(-50%) rotate(-8deg) scale(0.2);
      width:120px; height:120px; opacity:0; pointer-events:none;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,.2));
    }
    .stamp-bounce { animation: stampIn .7s ease-out forwards; }
    @keyframes stampIn {
      0% { transform:translateX(-50%) rotate(-8deg) scale(0.2); opacity:0; }
      60% { transform:translateX(-50%) rotate(-6deg) scale(1.15); opacity:1; }
      100% { transform:translateX(-50%) rotate(-8deg) scale(1); opacity:1; }
    }

    .modal { position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal.show { display:flex; }
    .modal-card { width: min(960px, 92vw); background:#fff; border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.18); }
    .modal-header { display:flex; justify-content:space-between; align-items:center; padding:14px 18px; border-bottom:1px solid #eee; }
    .close-x { font-size:20px; font-weight:700; cursor:pointer; }
    .modal-body { padding:0; }

    .btn { padding:.6rem 1rem; border-radius:.75rem; font-weight:700; }
    .btn-green { background:var(--success); color:#fff; }
    .btn-purple { background:var(--accent); color:#fff; }
    .btn-red { background:var(--danger); color:#fff; }
    .btn-ghost { background:#f3f4f6; }
    .badge { display:inline-flex; align-items:center; gap:.5rem; padding:.4rem .75rem; border-radius:999px; font-weight:700; }
    .badge-silver { background:#eef2ff; border:2px solid #c7d2fe; }
    .badge-gold { background:#fff7e6; border:2px solid #facc15; }
    .badge-trophy { background:#fff1f2; border:2px solid #fb7185; }

    .trophy-wrap { position:fixed; left:50%; top:-40vh; transform:translateX(-50%); z-index:60; pointer-events:none; display:none; }
    .trophy-wrap.show { display:block; animation: dropIn 1s ease-out forwards, glow 2s ease-in-out 1s infinite alternate; }
    @keyframes dropIn { 0% { top:-40vh; } 80% { top:15vh; } 100% { top:18vh; } }
    @keyframes glow { from { filter: drop-shadow(0 0 0 rgba(250, 204, 21, .8)); } to { filter: drop-shadow(0 0 18px rgba(250, 204, 21, 1)); } }
  </style>
</head>
<body class="min-h-screen">
  <div id="trophy" class="trophy-wrap" aria-hidden="true">
    <svg width="220" height="220" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1"><stop offset="0%" stop-color="#facc15"/><stop offset="100%" stop-color="#eab308"/></linearGradient></defs>
      <g fill="url(#g)" stroke="#92400e" stroke-width="1">
        <path d="M12 8h40v6a14 14 0 0 1-14 14H26A14 14 0 0 1 12 14z"/>
        <path d="M16 8v-4h32v4z"/>
        <rect x="28" y="28" width="8" height="8" rx="1"/>
        <rect x="24" y="36" width="16" height="6" rx="1"/>
        <rect x="20" y="42" width="24" height="6" rx="1"/>
        <rect x="16" y="48" width="32" height="6" rx="1"/>
      </g>
      <circle cx="32" cy="19" r="7" fill="#fde68a" opacity=".7"/>
    </svg>
  </div>

  <header class="text-center px-4 py-6">
    <h1 class="text-3xl md:text-4xl font-extrabold text-[var(--headline)]">Badminton Skill Challenge</h1>
  </header>

  <section id="loginSection" class="max-w-xl card mx-auto p-6 my-6">
    <h2 class="text-xl font-bold">Student Login</h2>
    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
      <input id="studentId" class="border rounded-lg p-3" placeholder="Student ID" />
      <input id="studentName" class="border rounded-lg p-3" placeholder="Name" />
    </div>
    <div class="mt-4 flex gap-3">
      <button class="btn btn-green" onclick="login()">Login</button>
    </div>
  </section>

  <main id="app" class="container mx-auto px-4 pb-20 hidden">
    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
      <div class="flex items-center gap-2">
        <span id="helloText" class="font-bold"></span>
      </div>
      <div class="flex gap-2">
        <button class="btn btn-red" onclick="logout()">Logout</button>
      </div>
    </div>

    <section class="card p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 items-center gap-4">
        <div class="justify-self-center">
          <canvas id="overallChart" width="220" height="220" aria-label="Progress Chart" role="img"></canvas>
        </div>
        <div class="md:col-span-2">
          <h3 class="text-xl font-bold mb-2">Personal Progress</h3>
          <p id="overallText" class="text-sm text-gray-700 mb-3">Completed 0/5 (0%)</p>
          <div class="flex flex-wrap gap-2 items-center">
            <span id="badge3" class="badge badge-silver hidden">ü•à Silver (3/5)</span>
            <span id="badge4" class="badge badge-gold hidden">ü•á Gold (4/5)</span>
            <span id="badge5" class="badge badge-trophy hidden">üèÜ All Completed (5/5)</span>
          </div>
        </div>
      </div>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div id="cards" class="contents"></div>
    </section>
  </main>

  <div id="glossaryModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3 class="font-bold" id="glossaryTitle">Glossary</h3>
        <span class="close-x" onclick="closeGlossary()">‚úñ</span>
      </div>
      <div class="modal-body p-4">
        <p id="glossaryBody" class="text-gray-800 leading-7"></p>
      </div>
    </div>
  </div>

  <div id="videoModal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3 class="font-bold" id="videoTitle">Learning Resource</h3>
        <span class="close-x" onclick="closeVideo()">‚úñ</span>
      </div>
      <div class="modal-body">
        <div class="aspect-video w-full">
          <iframe id="videoFrame" class="w-full h-[60vh]" src="" title="YouTube video" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    const TOTAL = 5;
    const PASSWORD = "888";
    let currentStudent = null;

    const GLOSSARY = {
      'Clear Shot': 'A high deep shot hit from the back court to the opponent\'s back court. Focus on side-on stance, hitting point above and slightly in front of body, and full swing follow-through.',
      'Net Drop': 'A delicate shot played close to the net. Keep the racket face steady and use a soft touch so the shuttle falls right behind the net.',
      'Smash': 'An attacking downward shot. Raise elbow, extend upward, hit at the highest point slightly in front, and land with balance.',
      'Rally': 'Emphasizes rhythm and consistency. Use about 70% power, return as shuttle crosses midline, focus on footwork and racket stability.',
      'Star Footwork': 'Simulates movement in 8 directions. Start fast, adjust with small steps, and return to center with balance.'
    };

    const CHALLENGES = [
      {title:'Clear Shot', goal:'Hit the shuttle high and deep to the opponent\'s back court.', method:'With a partner at baseline, successfully hit 5 clears to the back court.', video:'https://www.youtube.com/watch?v=CJXAXS82m5M'},
      {title:'Net Drop', goal:'Control soft shots over the net.', method:'Play net shots with partner, successfully land 5 within 1 meter of the net.', video:'https://www.youtube.com/watch?v=dR-NXBW2m5c'},
      {title:'Smash', goal:'Learn downward hitting technique.', method:'Partner tosses the shuttle above your head, successfully smash 3 times into opponent court.', video:'https://www.youtube.com/watch?v=lZSFU_OpbCw'},
      {title:'Rally', goal:'Build consistency and coordination.', method:'Rally with light power, 10 consecutive returns without dropping.', video:'https://www.youtube.com/watch?v=3A22dThPUT0'},
      {title:'Star Footwork', goal:'Familiarize with 8 directions footwork.', method:'Move from center to 8 directions and back, complete 1 cycle within 60 seconds.', video:'https://www.youtube.com/watch?v=b0ZXWXMsVDM'}
    ];

    const qs = (sel) => document.querySelector(sel);
    const nowISO = () => new Date().toISOString();
    function keyFor(student) { return `badminton_${student}`; }
    function getProgress(student) { return JSON.parse(localStorage.getItem(keyFor(student)) || '{}'); }
    function setProgress(student, obj) { localStorage.setItem(keyFor(student), JSON.stringify(obj)); }
    function beep() { const ctx = new (window.AudioContext||window.webkitAudioContext)(); const o = ctx.createOscillator(); const g = ctx.createGain(); o.type='triangle'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(0.0001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.35, ctx.currentTime + 0.01); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.32); o.start(); o.stop(ctx.currentTime + 0.33); }

    function login() {
      const id = qs('#studentId').value.trim();
      const name = qs('#studentName').value.trim();
      if(!id || !name) return alert('Please enter ID and Name');
      currentStudent = `${id}_${name}`;
      const p = getProgress(currentStudent);
      if(!p._meta) p._meta = { createdAt: nowISO(), lastUpdatedAt: nowISO(), wrongPassword: {}, firstFinishAt: null };
      setProgress(currentStudent, p);
      qs('#helloText').textContent = `Hi, ${name}`;
      qs('#loginSection').classList.add('hidden');
      qs('#app').classList.remove('hidden');
      renderCards(); loadStamps(); updateOverall();
    }
    function logout(){ currentStudent=null; qs('#app').classList.add('hidden'); qs('#loginSection').classList.remove('hidden'); qs('#studentId').value=''; qs('#studentName').value=''; }

    function cardTemplate(idx, c){
      return `
      <article class="card p-5 stamp-wrap relative">
        <svg id="stamp${idx}" class="stamp-svg" viewBox="0 0 120 120" aria-hidden="true">
          <circle cx="60" cy="60" r="46" fill="none" stroke="#ef4444" stroke-width="6"></circle>
          <text x="60" y="66" text-anchor="middle" font-size="26" font-weight="800" fill="#ef4444" style="letter-spacing:2px;">DONE</text>
        </svg>
        <h3 class="text-xl font-bold text-[var(--headline)] mb-2">Challenge ${idx}: ${c.title}</h3>
        <p class="text-sm text-gray-700"><b>Goal:</b> ${c.goal}</p>
        <p class="text-sm text-gray-700 mt-1"><b>Method:</b> ${c.method}</p>
        <div class="mt-4 flex flex-wrap gap-2">
          <button class="btn btn-ghost" onclick="openGlossary('${c.title}')">‚ú® Glossary</button>
          <button class="btn btn-purple" onclick="openVideo(${idx}, '${c.title}', '${c.video}')">üìò Resource</button>
          <button class="btn btn-green" onclick="verify(${idx}, '${c.title}')">‚úÖ Complete</button>
        </div>
      </article>`;
    }
    function renderCards(){ qs('#cards').innerHTML = CHALLENGES.map((c,i)=>cardTemplate(i+1,c)).join(''); }

    function loadStamps(){ const p=getProgress(currentStudent); for(let i=1;i<=TOTAL;i++){ if(p['challenge'+i]===true) qs('#stamp'+i)?.classList.add('stamp-bounce'); } }
    function markDone(i){ const el=qs('#stamp"+i); if(!el) return; el.classList.remove('stamp-bounce'); void el.offsetWidth; el.classList.add('stamp-bounce'); }
    function verify(i, title){
      const input = prompt(`Enter password to confirm Challenge ${i}: ${title}`);
      const p = getProgress(currentStudent); if(!p._meta) p._meta={createdAt:nowISO(),lastUpdatedAt:nowISO(),wrongPassword:{},firstFinishAt:null};
      if(input===null) return;
      if(input===PASSWORD){ p['challenge'+i]=true; p._meta.lastUpdatedAt=nowISO(); const count=countCompleted(p); if(count===TOTAL && !p._meta.firstFinishAt) p._meta.firstFinishAt=nowISO(); setProgress(currentStudent,p); markDone(i); beep(); updateOverall(); alert(`üéâ Congrats! Challenge ${i} completed!`); }
      else { const wp=p._meta.wrongPassword||{}; wp[i]=(wp[i]||0)+1; p._meta.wrongPassword=wp; p._meta.lastUpdatedAt=nowISO(); setProgress(currentStudent,p); alert(wp[i]>=3?'‚ùó Wrong password entered 3 times.':'‚ùå Wrong password, try
